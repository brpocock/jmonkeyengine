<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<!-- $Id$ -->
<HTML>
  <HEAD>
    <TITLE>Blender / jME Exporter Help</TITLE>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<html>
<head>
    <STYLE>
      body, table, div {
          font-family:sans-serif:0;
          font-size:14px;
          border:0;
          padding:0;
      }
      table, div {
          margin:0;
      }
      body { background-color:white; margin:10px; }
      code { font-family:monospace; }
      table.data { background-color:silver; }
      table.data td, table.data th { border:solid gray 1px; }
      th { font-size:80%; }
      td, th { padding:3px; }
      tr.odd td { background-color:#E6E6FA; }
      tr.even td { background-color:#E0FFFF; }
      li { margin-top:3; margin-bottom:3px; }
      div.footer { font-size:12px; }
      span.addr { font-style:italic; white-space:nowrap; }
    </STYLE>
  </HEAD>
  <BODY>
    <h3>Blender / jME Exporter Help</h3>
    Covers version ${product.version}.
    <BR/>
    Copyright 2009 by Blaine Simpson and the jME team,
    with the included BSD open source license.
    <HR/>
    <h4>Interface</h4>
    <table cellspacing="0"><tr><td>
      <img src="exporterbox.png" style="float:left; margin-right:20px;"/>
      </td><td>
    <UL>
      <LI><b>Object(s) to export</b>
        Choose to export either all SELECTED exportable objects,
        or all exportable objects in the active scene.
        Toggle back and forth to see how many objects qualify each way.
      <LI><b>Overwrite...</b>
        Choose whether to overwrite export files without confirmation.
        If the target file does not exist yet, this setting has no effect.
      <LI><b>Make axes jME-conformant</b>
        Rotate the X axis by -90 degrees, to make the exported scene +Z forward.
      <LI><b>Unsupported Material-handling</b>
        This setting has no effect unless the items to be exported contain
        unsupported materials.
        Choose whether to skip objects which contain unsupported materials;
        or to export such objects without the unsupported materials.
        Toggle back and forth to see how many objects qualify each way
        (export object counts are shown inside the top button).
    </UL>
      </td></tr></table>
    <HR/>
    <h4>Blender Settings Supported</h4>
      The following Blender settings are converted preserved in an export.<UL>
        <LI>3-vertex meshes.  Converted to jME TriMeshes.
        <LI>4-vertex meshes.  Converted to jME QuadMeshes.
        <LI>3- and 4- vertex meshes.  Converted to jME TriMeshes.
        <LI>Blender object nesting (parent/child relationships) is preserved.
        <LI>Object coloring (saved as jME mesh defaultColor)
        <LI>Vertex coloring.  Includes support for distinct per-face colors.
        <LI>Sticky UV texCoords.
        <LI>Per-face UV texCoords.
            Includes support for distinct per-face colors, and the
            "VCol Light" setting.
        <LI>Material sharing.  Two-Sided of containing mesh is honored
            (duplicated if necessary if material is shared).
        <LI>These Material colorings are converted<UL>
          <LI>Diffuse colors ("Col")
          <LI>Specular colors
          <LI>Alpha
          <LI>Specularity
          <LI>Emit
          <LI>Ambient (with world ambient color compensated for)
        </UL>
        <LI>Texture sharing
        <LI>Image textures, with support for the following options<UL>
          <LI>Texture offsets
          <LI>Texture size (scale)
          <LI>Extend, Clip, and Repeat wrap modes
          <LI>Mix, Multiply, and Add blending modes
        </UL>
        <LI>Textures + Materials.
          Supported modes combine as they should.
          You can, for example, overlay a file with transparency and see
          through the transparent parts to the material beneath.
      </UL>
    <HR/>
    <h4>Usage Tips</h4>
      <UL>
        <LI><b>Details</b>
          To find out details about why the exporter refuses to export
          specific objects; or details about any failure, start Blender from the
          command-line.  When you attempt to export, messages about failures, or
          why items are rejected are written to stdout.
        <LI><b>Real Program Problems</b>
          I do not have time to teach you Blender or jME, but if you have taken
          the time to produce evidence (like test cases) that a problem is due
          to the exporter itself, please contact me.
          <span class="addr">blaine (dot) simpson (at) admc (dot) com</span>
          <LI><b>Apply modifiers</b>
          If you want your export to reflect your modifiers, such as
          <i>subsurf</i>, you need to apply them.
          In general, you should not save applied modifiers to your .blend
          source files, since it is much easier to edit meshes without the
          effects of modifers.
          Therefore, the suggested procedure is to <OL>
            <LI>Save your image (to normal .blend file)
            <LI>Apply all of your mesh modifiers
            <LI>Export your model
            <LI>Re-open your blend-file to restore the pre-modified modifiers.
          </OL>
        <LI><b>Use .blend-file-relative resource files</b>
          If selecting a resource file for loading or saving, make sure that
          you have already saved your scene to a .blend file (so Blender can
          figure out what directory to make files relative to), then <UL>
            <LI>With the file Blender's file selection widget, make sure to
                enable the "Relative Paths" toggle button.
            <LI>When keying in a path, make sure to begin the path with "//",
                which means relative-to-the-.blend file.
          </UL>
          You are advised to go into Blender's User Preferences, the File Paths
          tab, and turn on the "Relative Paths Default" toggle (and Save
          Default Settings to persist the change).
          <P>
          Make sure to deliver the resource files along with your *-jme.xml
          file.
          </P>
        <LI><b>On the jME side, make the resource files available</b>
          Subversion revision 4263 and later of jMonkeyEngine v. 2 contain my
          modification to seek relative texture files relative to the
          containing XML file.
          If you are using a jME code base without this enhancement, you will
          need to make the resource files
          visible to the static ResourceLocatorTool that XMLImporter uses
          (not that static discovery tools are bad, but static storage of
          application state discovery paths is).
          I recommend this approach temporarily:<PRE style="background-color:#FFFFE0;"><CODE style="background-color:#FFFFE0;">
    ResourceLocator modelResLocator = new SimpleResourceLocator(
            xmlFile.getParentFile().toURI());
    ResourceLocatorTool.addResourceLocator(ResourceLocatorTool.TYPE_TEXTURE,
            modelResLocator);
    Object o =importer.load(file);
    ResourceLocatorTool.removeResourceLocator(ResourceLocatorTool.TYPE_TEXTURE,
            modelResLocator));
          </CODE></PRE>
          For brevity, I leave implementation of the try/finally block to you.
        <LI><b>Ambient Coloring</b>
          jMonkeyEngine has much more fine-grained support for ambient coloring
          than Blender has.
          In Blender, you see ambient coloration only if you have set the
          World object's ambient lighting color, and every object will have
          this as it's ambient color.
          This results in pretty unrelealistic coloring on the shadow sides of
          objects.
          The exporter applies the following behavior if you lave World ambient
          coloring off (which is the default state).
          It sets the Material's ambient color to a mix of a gray and the
          material's diffuse color.
          I.e., a <i>washed out version</i> of the object's diffuse color.
          This gives a realistic appearance in JME when you have light
          source(s) that emanate ambient and other light types.
          If you have set a world ambient color, then this is obviously the
          color that you intend for your objects to show in shadows, so that
          is exactly what we save as the jME ambient color for all of your
          materials.
    </UL>
    <HR/>
    <h4>Mapping Blender items to jME items</h4>
      <UL>
        <LI><b>Color and Mateiral inheritance</b>
          Both vertex coloring and "defaultColors" are mesh-specific objects
          in jME, and since Geometries can not have children, there is no
          inheritance.
          But for materials, even though in Blender you will not see any
          inheritance, the generated export will reflect intuitive material
          inheritance.
          By default, Blender links materials to Meshes, and if you link them
          this way, there will be no inheritance for the reason explained above.
          If you change the material linking to Objects explitly, or change the
          default in your Blender User Preferences, the material settings will
          be inherited according to the object parenting relationships.
          These relationships are easily seen in the Outliner window.
          <P>
          Another quirk in Blender is that at any time, an Object's
          Object-linked materials are active, or the Object's Mesh-linked
          materials.
          This is reflected both in the 3D View and in renders.
          In jME, the more specific material will override by default, just as
          you would want in a scene graph (this behavior can be modified by
          changing a Spatial's MaterialState inheritance mode).
          </P>
        <LI><b>Object colors</b>
          Object colors are usually only set by Blender users who use the
          Blender Game features.
          If you set the object color, we will save it as the Mesh's jME
          defaultColor setting.
        <LI><b>Vertex coloring</b>
          If you color vertexes, for example by using Blender's Vertex Paint
          mode, a colorBuf element will be written for the mesh.
          The Mesh subpanel of the Editing buttons panel lists "Vertex Color"
          layers.  The exporter will export the currently active vertex color
          layer.
          (Usually you will only have one such layer).
          <P>
          Be aware that when coloring vertexes in Blender, you are painting
          face-specific vertex colors.
          The exporter duplicates vertexes where necessary to accommodate jME's
          lack of face support.
          As an example of this, consider a blender Plane object which you
          subdivide on two opposing edges, making a plane with 6 vertexes and
          2 faces.
          This object would export to a 6-vertex jME QuadMesh unless you paint
          the middle vertexes with different colors for the two faces.
          In that case, the object would export to an 8-vertex jME QuadMesh,
          since the middle vertexes need to be duplicated in order to persist
          the unique colorings.
          </P>
        <LI><b>Sticky UV texcoords</b>
          If a mesh has Sticky UV values, they will be saved as jME TexCoords.
          You can tell whether you have sticky UV values by the text on the
          "Sticky:" button in the Mesh subpanel of the Editing buttons panel.
          If it says "Make", you have none; if it says "Delete", you have them.
          While sticky UV values are a direct match to jME TexCoords and
          require no conversion, they are poorly supported in Blender, and you
          are really restricted with them compared to Per-face UV values.
        <LI><b>Per-face UV texcoords</b>
          If a mesh has Per-face UV values, they will be saved as jME TexCoords.
          The Mesh subpanel of the Editing buttons panel lists per-face UV
          values as "UV Texture" layers.
          The exporter will export the currently active UV Texture layer.
          (Usually you will only have one such layer).
          <P>
          The exporter duplicates vertexes where necessary to accommodate jME's
          lack of face support.
          The example above under "Vertex coloring" shows the implications of
          this (just replace "UV values" where that description talks about
          color values).
          <P/>
      </UL>
    <HR/>
    <h4>UV Coordinates and Values</h4>
      For those who need to manipulate UV values manually, be aware that the
      conventions used by Blender are bizarre.
      <UL>
        <LI><b>Sticky Vertex UVs</b>
          Contrary to everything I've ever heard of UV mapping, these values
          run from -1 to 1.  Value (-1, -1) corresponds to the
          bottom-leftmost pixel of the texture image (with (1,1) mapping to
          the opposite corner).
        <LI><b>Per-Face-Vertex UVs</b>
          Like they should, the values run from 0 to 1.
          Value (0, 0) corresponds to the bottom-leftmost pixel of the texture
          image (with (1,1) mapping to the opposite corner).
      </UL>
      jME maps (u,v) of (0,0) to the upper-leftmost pixel of the texture image
      (with (1,1) mapping to the opposite corner).
      According to the sources I can find, this is how UV values are supposed
      to map to texture images.
      The exporter converts the values from Blender-convention to
      jME-convention as necessary.
    <HR/>
    <DIV class="footer">
      $Revision$
      <BR/>
      Last modified $Date$
      <BR/>
      <span class="addr">blaine (dot) simpson (at) admc (dot) com</span>
    </DIV>
  </BODY>
</HTML>
